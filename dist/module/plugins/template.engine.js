/* grapper - 1.1.0-beta.8 [module:plugin.template.engine] */ var mt="function",ht="undefined",U="object",dt="string",q="array",P="number";var I=(t,e)=>typeof t===e;var E=t=>I(t,U),w=t=>I(t,dt),k=t=>I(t,mt),J=t=>I(t,P)&&!isNaN(t),K=t=>!Number.isNaN(t),B=t=>I(t,ht);var R=t=>Array.isArray(t);var X=t=>t.replace(/-([a-z0-9])/g,(e,n)=>n.toUpperCase());var W=new Map;var $t=async function(){}.constructor;function v(t,e,n=!1){let c=`${t.join(",")} ${e}`;if(W.has(c))return W.get(c);let a=new(n?$t:Function)(...t,e);return W.set(c,a),a}var G="animate",xt="path",Z="d",Q="transform",yt="rotate",_="translate",tt="inherit",et="finished",Nt=t=>/^(rotate|skewX|skewY)$/.test(t),gt=t=>/^(translate|width|height|x|y|cx|cy|r|rx|ry|dx|dy)$/.test(t),Et=(t,e)=>t&&/^(text|tspan)$/.test(t)&&/^([xy])$/.test(e),H=!1;if(window.matchMedia){let t=window.matchMedia("(prefers-reduced-motion: reduce)");H=t.matches,t.addEventListener("change",()=>{H=t.matches})}var At=t=>t.replace(/([A-Z])/g,"-$1").toLowerCase();function St(t,e={duration:200},n=null,c=null){let a=this.gSVG,l=r=>{let u=E(r)?{...r}:{duration:r};return H&&(u.duration=0),u.fill="none",u},f=r=>{r=R(r)?r:[r];let u=window.getComputedStyle(this._el),m=[],s=new Set;for(let x of r){let d={};for(let S in x){let y=X(S);d[y]=p(x[S],y),!(y in u)||Et(this.tagName(),y)?s.add(y):y===Z?d.d=`${xt}("${d.d}")`:y===Q&&(d.transform=h(d.transform))}m.push(d)}return o(s,m),m},i=[],o=(r,u)=>{if(r.size){let m=new KeyframeEffect(null,u).getKeyframes();for(let s of r){let x=a(G).attributeName(s).dur(M.duration+"ms").fill("freeze").begin("indefinite");if(u.length===1)x.to(u[0][s]);else{let d=[],S=[];for(let y in m){let pt=m[y];s in u[y]&&(d.push(pt.computedOffset),S.push(u[y][s]))}d[0]!==0&&(d.unshift(0),S.unshift(this[s]()||tt)),d[d.length-1]!==1&&(d.push(1),S.push(this[s]()||tt)),x.keyTimes(d.join(";")).values(S.join(";"))}i.push(x),x.attachTo(this),x.beginElementAt((M.delay||0)/1e3)}}},h=r=>{w(r)&&(r=JSON.parse("{"+r.trim().replace(/^(\w+)\s*\(\s*([^)]+)\s*\)\s*$/,(m,s,x)=>`"${s}": [${x.trim().split(/\s*,\s*|\s+/).map(d=>/^[-+]?\d+(?:\.\d+)?$/.test(d)?d:`"${d}"`).join(", ")}]`)+"}"));let u="";for(let m in r)if(m===yt){let s=$(r[m]);s.length>1&&(u+=`${_}(${p(s[1],_)},${p(s[2],_)}) `),u+=`${m}(${p(s[0],m)}) `,s.length>1&&(u+=`${_}(-${p(s[1],_)},-${p(s[2],_)}) `)}else u+=`${m}(${$(r[m]).map(s=>p(s,m)).join(",")}) `;return u},$=r=>R(r)?r:String(r).split(/\s+|,/),p=(r,u)=>w(r)&&/deg|px/.test(r)?r:Nt(u)?r+"deg":gt(u)?r+"px":r,A=r=>w(r)?r.replace(/(deg)|(px)/g,"").trim():r,b=r=>r.replace(/(path\s*\(\s*["'])|(["']\s*\)\s*$)/g,"").trim().replace(/([a-zA-Z])\s*/g,"$1").replace(/\s+/g,","),Y=r=>{let u=/translate\((.*)px,(.*)px\) rotate\((.*)deg\) translate\((.*)px,(.*)px\)\s+/,m=u.exec(r);return m&&Number(m[1])===Number(m[4])*-1&&Number(m[2])===Number(m[5])*-1?r=r.replace(u,`rotate(${m[3]}, ${m[1]}, ${m[2]})`):r=A(r),r},M=l(e),g=f(t),T=this._el.animate(g,M);return T.ready.then(()=>k(n)&&n.call(this,T)),T.finished.then(()=>{let r=g[g.length-1];for(let s in r){let x=At(s);x.startsWith("text-")?this._el.style[s]=r[s]:s!=="offset"&&s in r&&this._el.setAttribute(x,x===Z?b(r[s]):x===Q?Y(r[s]):A(r[s]))}i.forEach(s=>s[et](!0));let u=this._el.querySelectorAll(G),m=this._el.querySelectorAll(`${G}[${et}]`);u.length===m.length&&u.forEach(s=>s.remove()),k(c)&&c.call(this,T)}),this}function bt(t){t.extendInstance({animateTo:St})}var nt=bt;var O={},rt=Symbol(),at=Symbol(),N=Symbol(),L=Symbol(),D=Symbol(),j=Symbol(),it=Symbol(),z="error",Tt="unknown",ot='an invalid "g-for" expression',wt="undefined",Rt="NaN (Not a Number)",V=(t,e)=>new Error(`The expression "${t}" return ${e} value`),st="class",ct="style",_t=(t,e,n)=>{throw new Error(t+` in ${e} `+n)},Lt=(t=>e=>t[e]||e)("attributeName attributeType baseFrequency calcMode clipPathUnits diffuseConstant edgeMode gradientTransform gradientUnits kernelMatrix kernelUnitLength lengthAdjust limitingConeAngle markerHeight markerUnits markerWidth maskContentUnits maskUnits numOctaves pathLength patternContentUnits patternTransform patternUnits pointsAtX pointsAtY pointsAtZ preserveAlpha preserveAspectRatio primitiveUnits refX refY requiredExtensions requiredFeatures specularConstant specularExponent spreadMethod startOffset stdDeviation stitchTiles surfaceScale systemLanguage tableValues targetX targetY textLength viewBox xChannelSelector yChannelSelector zoomAndPan".split(" ").reduce((t,e)=>(t[e.toLowerCase()]=e,t),{}));function ut(t){if(!t?.el?.parentNode)return null;let e=document.createComment(" ref ");return t.parentNode().insertBefore(e,t.el),t.remove(),e[j]=t,e}function ft(t){try{return new Function(`let ${t} = 0`),!0}catch{return!1}}function Ct(t){let e=t[j];return t.parentNode.insertBefore(e.el,t),t.remove(),e}C({name:"g-content",exec(t,{expr:e,data:n,evalExpr:c}){let a={...n,$$:{fromURL:async o=>{let h=await fetch(o);if(h.status===200)return h.text();console.warn(`Failed to load URL: ${o} (${h.status})`)},element:t,currentContent:t.content,...n.$||{}}};a.$=a.$$;let l=c(e,a),f=new CustomEvent("load",{bubbles:!0,detail:t}),i=o=>B(o)?"":o;E(l)&&l.then?l.then(o=>{t.content(i(o)),t.dispatchEvent(f)}):(t.content(i(l)),t.dispatchEvent(f))}});C({name:"g-if",exec(t,{expr:e,data:n,evalExpr:c}){if(!c(e,n))return t[N]&&(t[N].forEach(a=>a.remove()),delete t[N]),ut(t)}});C({name:"g-bind",alias:":",arg:!0,exec(t,{expr:e,arg:n,data:c,evalExpr:a}){n=Lt(n);let l=t._el,f={...c,$$:["d","transform"].includes(n)?t["$"+n]:{}};Object.assign(f.$$,{get element(){return t},get attribute(){return n},currentValue(){return n===st?[...l.classList]:n===ct?[...l.style].reduce((o,h)=>(o[h]=l.style[h],o),{}):t[n]()},dynamic(o,h=200,$=0){return t.animateTo((R(o)?o:[o]).map(p=>E(p)&&"offset"in p?{[n]:p.value,offset:p.offset}:{[n]:p}),{duration:h,delay:$}),it},...c.$||{}}),f.$=f.$$;let i=a(e,f);if(B(i))throw V(e,wt);if(n===st){let o=p=>t.classList.add(p),h=p=>t.classList.remove(p),$=p=>Object.entries(p).forEach(([A,b])=>b?o(A):h(A));if(R(i)){i.forEach(p=>w(p)?o(p):E(p)?$(p):void 0);return}if(E(i)){$(i);return}i&&o(i);return}if(n===ct){Object.entries(i).forEach(([o,h])=>t.style[o](h));return}i!==it&&t[n](i)}});C({name:"g-on",alias:"@",arg:!0,exec(t,{expr:e,arg:n,data:c,evalExpr:a,error:l,code:f}){t[D]=t[D]||{};let i=t[D][n]=t[D][n]||new Map;i.has(e)&&t.removeEventListener(n,i.get(e));let o=function(h){try{let $=a(e,c,t);k($)&&$.call(t,h)}catch($){l($.message,{directive:"g-on",argument:n,expression:e,toString(){return`g-on:${n}="${e}"`}},f)}};t.addEventListener(n,o),i.set(e,o),n==="init"&&!t[rt]&&(t[rt]=!0,t.dispatchEvent(new Event("init")))}});C({name:"g-for",tmpl:!0,exec(t,{expr:e,data:n,error:c}){t[N]=t[N]||[];let a=t.gSVG(ut(t)),l=0;return Ft(e,n,f=>{if(t[N][l])F(t[N][l],f,c,!1);else{let i=t.gSVG(t.tagName());i[L]=t[L].filter(o=>o.name!=="g-for"),[...t.attributes()].forEach(o=>{o.name!=="g-for"&&i.setAttribute(o.name,o.value)}),t.children().forEach(o=>{i.add(o.cloneNode(!0))}),a.before(i),F(i,f,c),i[at]=!0,t[N].push(i)}l++},f=>{for(;t[N].length>f.length;)t[N].pop().remove()}),!0}});function C({name:t,alias:e,arg:n,tmpl:c,exec:a}){let l=`^(${t}${n?":":""}${e?`|${e})`:")"}${n?"(.*)$":"$"}`,f=new RegExp(l,"i");O[t]={name:t,alias:e,arg:n,tmpl:c,exec:a,check:f}}function Mt(t){for(let e in O){let n=O[e],c=n.check.exec(t);if(c){let a=c[2];return{...n,arg:a}}}}function It(t){return t.replace(/[{}()[\]]/g,"").split(",").map(e=>(e.includes(":")?e.split(":")[1].trim():e).trim())}function kt(t,e){return t[Symbol.iterator]?e==="of"?{iterator:[...t],type:q}:{type:z}:J(t)?{iterator:Array(t<0?0:0|t).fill(0).map((n,c)=>c+(e==="of"?0:1)),type:P}:E(t)?e==="in"?{iterator:Object.entries(t).map(n=>n.reverse()),type:U}:{type:z}:{iterator:t,type:Tt}}function lt(t,e,n=null){let c=Object.keys(e).filter(ft),l=v(c,`return ( ${t} ); `).apply(n,c.map(f=>e[f]));if(!K(l))throw V(t,Rt);return l}function Ft(t,e,n,c){let a="__$$i",l="__$$c",f="__$$f",i=t.match(/^\s*([\s\S]+?)[\s*|)}\]](of|in)[\s*|({[]([\s\S]+?)\s*$/);if(!i)throw V(t,ot);let[,o,h,$]=i;h=h.trim(),o=o.trim(),$=$.trim();let p=lt($,e)||[],{iterator:A,type:b}=kt(p,h);if(b===z)throw V(t,ot);b===U&&!o.startsWith("[")&&(o=`[${o.replace(/(^\()|(\)$)/g,"")}]`);let Y=It(o),M=o.startsWith("(")?o:`(${o})`,g=Object.keys(e).filter(ft),T=` ${a}.forEach(${M} => { ${l}({${g}${g.length?",":""}${Y.join(",")}}); }); ${f}(${a}); `;return v([...g,a,l,f],T)(...g.map(u=>e[u]),A,n,c)}function F(t,e,n,c=!0){if(c&&t[at])return;let a=t.outerHTML();t[L]=t[L]||[];let l=t.attributes();for(let i of[...l]){let o=i.name,h=Mt(o);h&&(t[L].push({...h,expr:i.value}),t.removeAttribute(o))}let f=!1;for(let i of t[L]){f=i.tmpl||f;try{if(i.exec(t,{...i,data:e,evalExpr:lt,error:n,code:a}))return}catch(o){n(o.message,{directive:i.name,argument:i.arg,expression:i.expr,toString(){return`${i.name}${i.arg?":"+i.arg:""}="${i.expr}"`}},a)}}if(!f)for(let i of t.childNodes())i.el[j]?F(Ct(i.el),e,n):i.el?.nodeType===1&&F(i,e,n)}function Ut(t={},e=_t){F(this,t,e),this.dispatchEvent(new Event("render"))}function Dt(){return this.outerHTML().replaceAll("<!-- ref -->","")}function Ot(t){t.install(nt),t.extendInstance({render:Ut,source:Dt}),t.extendSetup({extendTemplate:{defineDirective:C,getDirective(e){return O[e]}}})}var Ht=Ot;export{Ht as default};